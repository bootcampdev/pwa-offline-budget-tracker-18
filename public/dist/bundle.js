(()=>{let e,t,n=[];function a(){let e=n.reduce(((e,t)=>e+parseInt(t.value)),0);document.querySelector("#total").textContent=e}function o(){let e=document.querySelector("#tbody");e.innerHTML="",n.forEach((t=>{let n=document.createElement("tr");n.innerHTML=`\n      <td>${t.name}</td>\n      <td>${t.value}</td>\n    `,e.appendChild(n)}))}function r(){let t=n.slice().reverse(),a=0,o=t.map((e=>{let t=new Date(e.date);return`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`})),r=t.map((e=>(a+=parseInt(e.value),a)));e&&e.destroy();let l=document.getElementById("myChart").getContext("2d");e=new Chart(l,{type:"line",data:{labels:o,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#6666ff",data:r}]}})}function l(e){let l=document.querySelector("#t-name"),c=document.querySelector("#t-amount"),u=document.querySelector(".form .error");if(""===l.value||""===c.value)return void(u.textContent="Missing Information");u.textContent="";let d={name:l.value,value:c.value,date:(new Date).toISOString()};e||(d.value*=-1),n.unshift(d),r(),o(),a(),fetch("/api/transaction",{method:"POST",body:JSON.stringify(d),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.errors?u.textContent="Missing Information":(l.value="",c.value="")})).catch((e=>{var n;e&&console.log(e),n=d,console.log("trans-rec",n),t.transaction(["transaction"],"readwrite").objectStore("transaction").add({name:n.name,value:n.value,date:n.date}),l.value="",c.value=""}))}fetch("/api/transaction").then((e=>e.json())).then((e=>{n=e,console.log("transaction after fetch ",n),a(),o(),r()}));const c=window.indexedDB.open("BudgetTrackerDb",1);c.onupgradeneeded=({target:e})=>{e.result.createObjectStore("transaction",{keyPath:"id",autoIncrement:!0})},c.onsuccess=e=>{console.log("idb rec create",c.result),t=e.target.result},document.querySelector("#add-btn").onclick=function(){l(!0)},document.querySelector("#sub-btn").onclick=function(){l(!1)}})();